<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mapa de mesas</title>
<style>
  :root{
    --accent: #ff7fbf;
    --accent-dark: #d95c98;
    --shadow: 0 6px 22px rgba(185,95,135,0.25);
    --debug-grid: rgba(90, 60, 82, 0.06);
  }
  body{
    margin:0;
    font-family: system-ui, sans-serif;
    background: linear-gradient(180deg,#fff6fb,#fff0f7);
    color:#3d2b3a;
    text-align:center;
  }
  header{
    padding:12px 0 4px 0;
  }
  svg{
    width:100%;
    height:auto;
    max-width:1056px;
    display:block;
    margin:auto;
    position:relative;
  }
  #indicador{
    fill:none;
    stroke:var(--accent);
    stroke-width:4;
    filter: drop-shadow(0 0 6px var(--accent-dark));
    transform-origin:center;
    animation: pulse 1s infinite;
  }
  @keyframes pulse {
    0% { transform: scale(1); opacity:1; }
    50% { transform: scale(1.3); opacity:0.5; }
    100% { transform: scale(1); opacity:1; }
  }

  .mensaje {
    margin:10px auto;
    display:inline-block;
    background:white;
    padding:8px 14px;
    border-radius:10px;
    box-shadow:0 4px 18px rgba(115,70,95,0.06);
  }

  .debug-grid line {
    stroke: var(--debug-grid);
    stroke-width: 1;
  }
  .coord-label {
    font-size:10px;
    fill:rgba(60,40,60,0.45);
  }
</style>
</head>
<body>
<header>
  <h1>Mapa de mesas</h1>
  <p>Ejemplo: <code>?mesa=05</code> â€” aÃ±ade <code>?debug=1</code> para ver la rejilla.</p>
</header>

<!-- el SVG real con las mesas ya dibujadas -->
<object id="svgMap" data="mapa.svg" type="image/svg+xml"></object>

<div id="mensaje" class="mensaje">Cargando mapa...</div>

<script>
(async ()=>{
  const getParam = p => new URLSearchParams(location.search).get(p);
  const mesaParam = getParam("mesa");
  const debug = getParam("debug")==="1";
  const msg = (t,c="")=>{
    const el=document.getElementById("mensaje");
    el.textContent=t;
    el.className="mensaje "+c;
  }

  let mesas=[];
  try{
    const r=await fetch("mesas.json",{cache:"no-store"});
    mesas=await r.json();
  }catch(e){
    msg("Error cargando mesas.json","error");
    return;
  }

  const svgObj=document.getElementById("svgMap");
  svgObj.addEventListener("load",()=>{
    const svgDoc=svgObj.contentDocument;
    const root=svgDoc.documentElement;

    if(debug){
      // dibuja rejilla
      const gridG=svgDoc.createElementNS("http://www.w3.org/2000/svg","g");
      gridG.setAttribute("class","debug-grid");
      for(let x=0;x<=1056;x+=48){
        const ln=svgDoc.createElementNS("http://www.w3.org/2000/svg","line");
        ln.setAttribute("x1",x);ln.setAttribute("x2",x);
        ln.setAttribute("y1",0);ln.setAttribute("y2",816);
        gridG.appendChild(ln);
      }
      for(let y=0;y<=816;y+=48){
        const ln=svgDoc.createElementNS("http://www.w3.org/2000/svg","line");
        ln.setAttribute("x1",0);ln.setAttribute("x2",1056);
        ln.setAttribute("y1",y);ln.setAttribute("y2",y);
        gridG.appendChild(ln);
      }
      mesas.forEach(m=>{
        const t=svgDoc.createElementNS("http://www.w3.org/2000/svg","text");
        t.setAttribute("x",m.x+10);
        t.setAttribute("y",m.y-10);
        t.setAttribute("class","coord-label");
        t.textContent=`${m.numero} (${m.x},${m.y})`;
        gridG.appendChild(t);
      });
      root.appendChild(gridG);
      msg("Modo debug activado");
    }

    if(!mesaParam){
      msg("No se especificÃ³ mesa (?mesa=##)");
      return;
    }
    const mesaNum=parseInt(mesaParam,10);
    const mesa=mesas.find(m=>parseInt(m.numero,10)===mesaNum);
    if(!mesa){
      msg(`La mesa ${mesaParam} no existe`);
      return;
    }

    // dibuja el indicador sobre la mesa
    const indic=svgDoc.createElementNS("http://www.w3.org/2000/svg","circle");
    indic.setAttribute("id","indicador");
    indic.setAttribute("cx",mesa.x);
    indic.setAttribute("cy",mesa.y);
    indic.setAttribute("r",mesa.r || 50);
    root.appendChild(indic);

    msg(`Mesa ${mesa.numero} localizada ðŸŽ‰`);
  });
})();
</script>
</body>
</html>
